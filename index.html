<!DOCTYPE html>
<!--[if IE 8]> 				 <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->

<head>
	<meta charset="utf-8" />
  <meta name="viewport" content="width=device-width" />
  <title>ISBN Lookup</title>

  <link rel="stylesheet" href="css/normalize.css" />
  
  <link rel="stylesheet" href="css/foundation.css" />
  

  <script src="js/vendor/jquery.js"></script>

  <style>
    .isbnLookup {
      margin-top: 40px;
    }
    .alignRight{
      text-align: right;
    }
    .lightText {
      color: #999;
    }
    .row.topSpace {
      margin-top: 30px;
    }
    
    .coverUp {
      width: 16px;
      height: 16px;
      background: rgba(255,255,255,.7);
      transition: background .3s linear;;
      -webkit-transition: background .3s linear;
    }

    .serviceIcon {
      display:inline-block;
      width: 16px;
      margin-top: 8px;
      margin-bottom: 8px;
    }
    .serviceGoogle {
      background-image:url('img/google.png');
    }
    .serviceLibraryThing {
      background-image:url('img/lt.png');
    }
    .serviceOpenLibrary {
      background-image:url('img/open.png');
    }
    .coverUp:hover{
      background: transparent;
    }
    label.tightLeft {
      padding-left: 0;
    }
    .bumpDown {
      margin-bottom:10px;
    }

  </style>

</head>
<body>
  <div class="row">
    <div class="large-10 small-10 large-offset-1 small-offset-1 columns">
      <h1>ISBN Lookup</h1>
    </div>
  </div>
      <div class="row">
        <div class="large-12 small-12 columns" id="bookInfo">

          <div class="row">

            <div class="small-10 large-5 large-offset-1 small-offset-1 columns">
                <label for="isbn" class="small-12 large-12 columns">ISBN</label>
                <input type="text" class="small-12 large-12 columns" id="isbn" placeholder="ISBN-10 or ISBN-13, with or without Dashes">
            </div>

            <div class="small-10 small-offset-1 large-5 large-offset-0 columns">
                <label class="small-12 large-12 columns lightText">Services</label>
                <div class="small-12 large-12 columns">
                  <div class="serviceIcon serviceGoogle">
                    <div class="coverUp"></div>
                  </div>
                  <div class="serviceIcon serviceOpenLibrary">
                    <div class="coverUp"></div>
                  </div>
                  <div class="serviceIcon serviceLibraryThing">
                    <div class="coverUp"></div>
                  </div>
                </div>
            </div>

            <div class="large-1 small-1">
            </div>

          </div>

          <div class="row">
            <div class="small-10 large-5 large-offset-1 small-offset-1 columns">
              <label for="bookTitle" class="small-12 large-12 columns lightText">Title</label>
              <input type="text" id="bookTitle" class="small-12 large-12 columns" placeholder="..."/>
            </div>
            <div class="small-10 small-offset-1 large-5 large-offset-0 columns">
              <label for="bookAuthor" class="small-12 large-12 columns lightText">Author</label>
              <input type="text" id="bookAuthor" class="small-12 large-12 columns" placeholder="..."/>
            </div>
            <div class="large-1 small-1">
            </div>
          </div>

          <div class="row">
            <div class="small-10 large-5 large-offset-1 small-offset-1 columns">
              <label for="bookPublisher" class="small-12 large-12 columns lightText">Publisher</label>
              <input type="text" id="bookPublisher" class="small-12 large-12 columns" placeholder="..."/>
            </div>
            <div class="small-10 small-offset-1 large-5 large-offset-0 columns">
              <label for="bookCity" class="small-12 large-12 columns lightText">City</label>
              <input type="text" id="bookCity" class="small-12 large-12 columns" placeholder="..."/>
            </div>
            <div class="large-1 small-1">
            </div>
          </div>

          <div class="row">
            <div class="small-10 large-5 large-offset-1 small-offset-1 columns">
              <label for="bookTitle" class="small-12 large-12 columns lightText">Date</label>
              <input type="text" id="bookDate" class="small-12 large-12 columns" placeholder="..."/>
            </div>
            <div class="small-10 small-offset-1 large-5 large-offset-0 columns">
              <label for="bookPages" class="small-12 large-12 columns lightText">Pages</label>
              <input type="text" id="bookPages" class="small-12 large-12 columns" placeholder="..."/>
            </div>
            <div class="large-1 small-1">
            </div>
          </div>

          <div class="row">

            <div class="small-10 large-5 large-offset-1 small-offset-1 columns">
              <label for="bookTitle" class="small-12 large-12 columns lightText">
                Google Books <img src="img/link.gif" />
              </label>
              <input type="text" id="googleLink" class="small-12 large-12 columns" placeholder="..."/>
              <label for="bookTitle" class="small-12 large-12 columns lightText">
                Powell <img src="img/link.gif" />
              </label>
              <input type="text" id="powellLink" class="small-12 large-12 columns" placeholder="..."/>
              <div class="small-12 large-12 columns bumpDown">
                <a href="#" class="bumpDown">+ add link</a>
              </div>
            </div>

            <div class="small-10 small-offset-1 large-5 large-offset-0 columns">

              <label for="" class="small-12 large-12 columns lightText">ISBN-10</label>
              <input type="text" id="" class="small-12 large-12 columns" placeholder="..."/>

              <label for="" class="small-12 large-12 columns lightText">ISBN-10</label>
              <input type="text" id="" class="small-12 large-12 columns" placeholder="..."/>

              <div class="small-12 large-12 columns bumpDown">
                <a href="#">+ add number</a>
              </div>

            </div>
            <div class="large-1 small-1">
            </div>

          </div>

          <div class="row bumpDown">
            
            <div class="small-10 large-5 large-offset-1 small-offset-1 columns">
              <label for="bookTitle" class="small-12 large-12 columns lightText">
                Description
              </label>
              <textarea id="bookDesc" class="small-12 large-12 columns">
              </textarea>
              
            </div>

            <div class="small-10 large-5 large-offset-0 small-offset-1 columns">

              <label for="bookTitle" class="small-12 large-12 columns lightText">
                Images
              </label>

              <div class="small-12 large-12 columns" style="min-height: 300px">
                <img src="" id="bookImg"/>
                <img src="" id="firstImage"/>
                <img src="" id="openLibraryImageSRC"/>
              </div>

            </div>

            <div class="large-1 small-1">
            </div>

          </div>

        </div>
      </div>

  <script>
  document.write('<script src=' +
  ('__proto__' in {} ? 'js/vendor/zepto' : 'js/vendor/jquery') +
  '.js><\/script>')
  </script>
  
  <script src="js/foundation.min.js"></script>
  <!--
  
  <script src="js/foundation/foundation.js"></script>
  
  <script src="js/foundation/foundation.dropdown.js"></script>
  
  <script src="js/foundation/foundation.alerts.js"></script>
  
  <script src="js/foundation/foundation.placeholder.js"></script>
  
  <script src="js/foundation/foundation.forms.js"></script>
  
  <script src="js/foundation/foundation.section.js"></script>
  
  <script src="js/foundation/foundation.tooltips.js"></script>
  
  <script src="js/foundation/foundation.topbar.js"></script>
  
  -->
  
  <script>
    $(document).foundation(function(){

      $('#isbn').keyup(function(){
        findInfo();
      });

      

    });
    function clearInfo(){
      $('.number').remove();
    }
    function findInfo(){
      clearInfo();
        var isbn = $('#isbn').val().trim();
        isbn = isbn.replace(/\-/g,'');
        //console.log(isbn);
        if (isbn.length == 10 || isbn.length == 13){

          var googleURL = 'https://www.googleapis.com/books/v1/volumes?q=isbn:'+isbn;
          var powellURL = 'http://www.powells.com/biblio/1-'+isbn+'-1';
          var openLibraryURL = 'http://openlibrary.org/isbn/'+isbn;
          var openLibraryImageSRC = 'http://covers.openlibrary.org/b/isbn/'+isbn+'-L.jpg';

          $('#powellLink').val(powellURL);

          $('#openLibraryImageSRC').attr('src',openLibraryImageSRC).attr('style','width:49%px');

          $.getJSON(googleURL, function(data){
            //console.log(data);
            var title = data.items[0].volumeInfo.title;
            $('#bookTitle').val(title);
            var authors ='';
            for (var i = 0; i < data.items[0].volumeInfo.authors.length; i++){
              if (i > 0){
                authors += ', ';
              }
              authors += data.items[0].volumeInfo.authors[i];
            }
            $('#bookAuthor').val(authors);
            $('#bookPages').val(data.items[0].volumeInfo.pageCount);
            $('#bookDescription').text(data.items[0].volumeInfo.description);
            var year = data.items[0].volumeInfo.publishedDate.split('-')[0];
            $('#bookDate').val(year);

            var infoLink = 'http://books.google.com/books?id=IkU8YgEACAAJ&dq=isbn:9781936719006&hl=&source=gbs_api';
            $('#googleLink').val(infoLink);
            

            for (var j=0; j < data.items[0].volumeInfo.industryIdentifiers.length; j++) {
              console.log(j);
              var thisDiv= $(document.createElement('div'));
              thisDiv.addClass('number');
              thisDiv.addClass('row');
              var thisNameDiv = $(document.createElement('div'));
              var thisNumDiv = $(document.createElement('div'));
              //small-3 columns alignRight lightText
              thisNameDiv.addClass('small-3');
              thisNameDiv.addClass('columns');
              thisNameDiv.addClass('alignRight');
              thisNameDiv.addClass('lightText');
              var thisName = data.items[0].volumeInfo.industryIdentifiers[j].type;
              thisNameDiv.text(thisName);
              //small-9 columns
              thisNumDiv.addClass('small-9');
              thisNumDiv.addClass('columns');
              var thisNum = data.items[0].volumeInfo.industryIdentifiers[j].identifier;
              thisNumDiv.text(thisNum);

              thisDiv.append(thisNameDiv);
              thisDiv.append(thisNumDiv);
              $('#bookInfo').append($(document.createElement('br')).addClass('number'));
              $('#bookInfo').append(thisDiv);

              $('#bookImg').attr('src','http://covers.librarything.com/devkey/441b3d90c036eff9fbb3813446316e92/large/isbn/'+isbn);
              //https://www.google.com/search?q=lean+startup+cover&hl=en&site=imghp&tbm=isch
              //var googleURL = 'https://www.google.com/search?q='+title.split(' ').join('+')+'+cover&hl=en&site=imghp&tbm=isch';
              //console.log(googleURL);
              

              $(document).load('./nodes/query.php?query='+title.split(' ').join('+')+'+cover', function(data){
                  var src = String(data);
                  $('#firstImage').attr('src',src);
                }
              );

              
              $('#firstImage').attr('style','width:49%');


            }
            
          });
        }
      }
  </script>
</body>
</html>
