<!DOCTYPE html>
<!--[if IE 8]> 				 <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->

<head>
	<meta charset="utf-8" />
  <meta name="viewport" content="width=device-width" />
  <title>ISBN Lookup</title>

  <link rel="stylesheet" href="css/normalize.css" />
  
  <link rel="stylesheet" href="css/foundation.css" />
  

  <script src="js/vendor/jquery.js"></script>

  <style>
    .isbnLookup {
      margin-top: 40px;
    }
    .alignRight{
      text-align: right;
    }
    .lightText {
      color: #999;
    }
    .row.topSpace {
      margin-top: 30px;
    }
  </style>

</head>
<body>
  <div class="row">
    <div class="large-8 small-8 large-offset-2 small-offset-2 columns">
      <h1>ISBN Lookup</h1>
    </div>
  </div>
      <div class="row">
        <div class="large-12 small-12 columns" id="bookInfo">

          <div class="row">

            <div class="small-2 large-2 columns">
              <label for="isbn" class="right inline">ISBN</label>
            </div>
            <div class="small-10 large-4 columns">
              <input type="text" id="isbn" placeholder="ISBN-10 or ISBN-13, with or without Dashes">
            </div>
            <div class="large-6 small-0">
            </div>

          </div>

          <hr/>

          <div class="row">

            <div class="small-2 large-2 columns alignRight lightText">
              <label for="bookTitle" class="right inline">Title</label>
            </div>
            <div class="small-10 large-4 columns">
              <input type="text" id="bookTitle" placeholder="..."/>
            </div>

            <div class="small-2 large-2 columns alignRight lightText">
              <label for="bookAuthor" class="right inline">Author</label>
            </div>
            <div class="small-10 large-4 columns">
              <input type="text" id="bookAuthor" placeholder="..."/>
            </div>

          </div>

          <div class="row">

            <div class="small-2 large-2 columns alignRight lightText">
              <label for="bookDate" class="right inline">Date</label>
            </div>
            <div class="small-10 large-4 columns">
              <input type="text" id="bookDate" placeholder="..."/>
            </div>

            <div class="small-2 large-2 columns alignRight lightText">
              <label for="bookPages" class="right inline">Pages</label>
            </div>
            <div class="small-10 large-4 columns">
              <input type="text" id="bookPages" placeholder="..."/>
            </div>

          </div>

          <div class="row">

            <div class="small-2 large-2 columns alignRight lightText">
              <label for="bookDescription" class="right inline">Description</label>
            </div>
            <div class="small-10 large-4 columns">
              <textarea id="bookDescription" style="height:142px"></textarea>
            </div>

            <div class="small-2 large-2 columns alignRight lightText">
              <label for="bookDescription" class="right inline">Google Link</label>
            </div>
            <div class="small-10 large-4 columns">
              <input type="text" id="googleLink"/>
            </div>

            <div class="small-2 large-2 columns alignRight lightText">
              <label for="bookDescription" class="right inline">Powell Link</label>
            </div>

            <div class="small-10 large-4 columns">
              <input type="text" id="powellLink"/>
            </div>

            <div class="small-10 large-4 columns">
              <a href="#">+ add link</a>
            </div>

          </div>

          <div class="row">
            <div class="small-2 large-2 columns alignRight lightText">
              <label for="imgs" class="right inline">Images</label>
            </div>
            <div class="small-10 large-4 columns" style="min-height: 300px">
              <img src="" id="bookImg"/>
              <img src="" id="firstImage"/>
              <img src="" id="openLibraryImageSRC"/>
            </div>

            <div class="small-2 large-2 columns alignRight lightText">
              <label for="imgs" class="right inline">ISBN-10</label>
            </div>
            <div class="small-10 large-4 columns">
              <input type="text" id="isbn10"/>
            </div>

            <div class="small-2 large-2 columns alignRight lightText">
              <label for="imgs" class="right inline">ISBN-13</label>
            </div>
            <div class="small-10 large-4 columns">
              <input type="text" id="isbn13"/>
            </div>

          </div>

        </div>
      </div>

  <script>
  document.write('<script src=' +
  ('__proto__' in {} ? 'js/vendor/zepto' : 'js/vendor/jquery') +
  '.js><\/script>')
  </script>
  
  <script src="js/foundation.min.js"></script>
  <!--
  
  <script src="js/foundation/foundation.js"></script>
  
  <script src="js/foundation/foundation.dropdown.js"></script>
  
  <script src="js/foundation/foundation.alerts.js"></script>
  
  <script src="js/foundation/foundation.placeholder.js"></script>
  
  <script src="js/foundation/foundation.forms.js"></script>
  
  <script src="js/foundation/foundation.section.js"></script>
  
  <script src="js/foundation/foundation.tooltips.js"></script>
  
  <script src="js/foundation/foundation.topbar.js"></script>
  
  -->
  
  <script>
    $(document).foundation(function(){

      $('#isbn').keyup(function(){
        findInfo();
      });

      

    });
    function clearInfo(){
      $('.number').remove();
    }
    function findInfo(){
      clearInfo();
        var isbn = $('#isbn').val().trim();
        isbn = isbn.replace(/\-/g,'');
        //console.log(isbn);
        if (isbn.length == 10 || isbn.length == 13){

          var googleURL = 'https://www.googleapis.com/books/v1/volumes?q=isbn:'+isbn;
          var powellURL = 'http://www.powells.com/biblio/1-'+isbn+'-1';
          var openLibraryURL = 'http://openlibrary.org/isbn/'+isbn;
          var openLibraryImageSRC = 'http://covers.openlibrary.org/b/isbn/'+isbn+'-L.jpg';

          $('#powellLink').val(powellURL);

          $('#openLibraryImageSRC').attr('src',openLibraryImageSRC).attr('style','width:49%px');

          $.getJSON(googleURL, function(data){
            //console.log(data);
            var title = data.items[0].volumeInfo.title;
            $('#bookTitle').val(title);
            var authors ='';
            for (var i = 0; i < data.items[0].volumeInfo.authors.length; i++){
              if (i > 0){
                authors += ', ';
              }
              authors += data.items[0].volumeInfo.authors[i];
            }
            $('#bookAuthor').val(authors);
            $('#bookPages').val(data.items[0].volumeInfo.pageCount);
            $('#bookDescription').text(data.items[0].volumeInfo.description);
            var year = data.items[0].volumeInfo.publishedDate.split('-')[0];
            $('#bookDate').val(year);

            var infoLink = 'http://books.google.com/books?id=IkU8YgEACAAJ&dq=isbn:9781936719006&hl=&source=gbs_api';
            $('#googleLink').val(infoLink);
            

            for (var j=0; j < data.items[0].volumeInfo.industryIdentifiers.length; j++) {
              console.log(j);
              var thisDiv= $(document.createElement('div'));
              thisDiv.addClass('number');
              thisDiv.addClass('row');
              var thisNameDiv = $(document.createElement('div'));
              var thisNumDiv = $(document.createElement('div'));
              //small-3 columns alignRight lightText
              thisNameDiv.addClass('small-3');
              thisNameDiv.addClass('columns');
              thisNameDiv.addClass('alignRight');
              thisNameDiv.addClass('lightText');
              var thisName = data.items[0].volumeInfo.industryIdentifiers[j].type;
              thisNameDiv.text(thisName);
              //small-9 columns
              thisNumDiv.addClass('small-9');
              thisNumDiv.addClass('columns');
              var thisNum = data.items[0].volumeInfo.industryIdentifiers[j].identifier;
              thisNumDiv.text(thisNum);

              thisDiv.append(thisNameDiv);
              thisDiv.append(thisNumDiv);
              $('#bookInfo').append($(document.createElement('br')).addClass('number'));
              $('#bookInfo').append(thisDiv);

              $('#bookImg').attr('src','http://covers.librarything.com/devkey/441b3d90c036eff9fbb3813446316e92/large/isbn/'+isbn);
              //https://www.google.com/search?q=lean+startup+cover&hl=en&site=imghp&tbm=isch
              //var googleURL = 'https://www.google.com/search?q='+title.split(' ').join('+')+'+cover&hl=en&site=imghp&tbm=isch';
              //console.log(googleURL);
              

              $(document).load('./nodes/query.php?query='+title.split(' ').join('+')+'+cover', function(data){
                  var src = String(data);
                  $('#firstImage').attr('src',src);
                }
              );

              
              $('#firstImage').attr('style','width:49%');


            }
            
          });
        }
      }
  </script>
</body>
</html>
